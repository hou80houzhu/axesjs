/*!
 * @packet opensite.mobi.form;
 * @require opensite.mobi.util.toast;
 * @require opensite.mobi.util.file;
 * @require opensite.mobi.util.base64;
 * @css opensite.mobi.style.form;
 * @template opensite.mobi.template.formtemplate;
 */Module({name:"baseform",extend:"viewgroup",option:{action:"",fields:[]},onbeforesubmit:null,onsubmitback:null,onsubmiterror:null,onneterror:null,getFieldByName:function(e){var t=null;return this.childEach(function(){return this.typeOf("@.basefield")&&this.getFieldName()===e?(t=this,!1):void 0}),t},check:function(){var e=!0,t=null;return this.childEach(function(){return this.typeOf("@.basefield")?(e=this.check(),t=this,e):void 0}),e&&this.customCheck&&(e=this.customCheck.call(this)),e||this.oncheckerror&&this.oncheckerror(t),e},reset:function(){this.childEach(function(){this.typeOf("@.basefield")&&this.reset()})},disable:function(){this.childEach(function(){this.typeOf("@.basefield")&&this.disable()})},getValues:function(){var e=[],t=[],i=$.promise();this.childEach(function(){this.typeOf("@.Aasys")?t.push(this):this.typeOf("@.basefield")&&e.push({name:this.getFieldName(),value:this.getValue()})});var s=$.queue();for(var n in t)s.add(function(t,i){i.asys(function(t){e.push({name:i.getFieldName(),value:t}),s.next(t)},t)},null,t[n]);return s.complete(function(){var t={};for(var s in e)t[e[s].name]=e[s].value;i.resolve(t)}),s.run(),i},setValues:function(e){e&&(this.parameters=e,this.childEach(function(){if(this.typeOf("@.basefield")){var t=e[this.getFieldName()];void 0!==t&&this.setValue(t)}}))},submit:function(e){var t=this,i=$.promise();return i.scope(this),this.check()?(this.getValues().done(function(s){t.onbeforesubmit&&t.onbeforesubmit(s),t.postData({url:t.option.action,data:e?e(s):s,back:function(e){t.onsubmitback&&t.onsubmitback(e),i.resolve(e)},dataerror:function(e){t.onsubmiterror&&t.onsubmiterror(e),i.reject(e.msg)},neterror:function(e){t.onneterror&&t.onneterror(),i.reject(e)}})}),i):i},onoption:function(e,t,i){var s=i.substring(1,i.length);return this.option.fields[s]},event_selectchange:function(e){var t=e.data.next,i=e.data.value;this.childEach(function(){this.typeOf("@.select")&&this.getFieldName()===t&&this.loadData(i)}),e.stopPropagation()},empty:function(){this.childEach(function(){this.typeOf("@.basefield")&&this.empty()})}}),Module({name:"basefield",extend:"view",option:{name:"",label:"",value:"",disabled:!1,required:!1},value:null,customCheck:null,check:function(){return this.customCheck?this.customCheck.call(this):!0},getValue:function(){return this.value},setValue:function(e){return this.value=e,this},disable:function(e){return this},reset:function(){return this.setValue(this.value),this},getFieldName:function(){return this.option.name},getLabelName:function(){return this.option.label},empty:function(){}}),Module({name:"field",extend:"@.basefield",className:"field"}),Module({name:"fieldgroup",extend:["viewgroup","@.basefield"]}),Module({name:"Aasys",asys:null,getValue:function(e){this.asys&&this.asys(e)}}),Module({name:"asysfield",extend:["@.field","@.Aasys"],asys:function(e){e&&e(this.value)}}),Module({name:"asysfieldgroup",extend:["@.fieldgroup","@.Aasys"],asys:function(e){e&&e(this.value)}}),Module({name:"text",extend:"@.field",option:{label:"text-label",isflex:!1,isblock:!0,ishow:!0,inputType:"text",reg:"",max:2e3,min:0,disabled:!1,desc:"",hook:null,encode:!1,placeholder:"",focus:!1},template:module.getTemplate("@formtemplate","text"),init:function(e){this.value=e.value,this.render(e),e.isflex&&this.dom.addClass("flex").width("100%");var t=this.finders.get("input");t.get(0).disabled=e.disabled,e.ishow||this.dom.hide(),this.option.focus&&t.get(0).focus()},find_input:function(e){this.input=e},bind_keyup:function(e){this.value=e.val(),this.check()},reg:{email:[/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,"请输入正确的email地址"],number:[/^[0-9]*$/,"请输入数字"],"int":[/^\+?[1-9][0-9]*$/,"非零正整数"],unint:[/^\-[1-9][0-9]*$/,"非零负整数"],intwith:[/^\d+$/,"正整数 + 0"],unintwith:[/^((-\d+)|(0+))$/,"负整数 + 0"],phone:[/(^13[0-9]{9}$)|(^15[0-9]{9}$)|(^14[0-9]{9}$)|(^17[0-9]{9}$)|(^18[0-9]{9}$)|^((\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$/,"请输入正确的电话号码"],en:[/^[A-Za-z]+$/,"26个英文字母组成的字符串"],enupper:[/^[A-Z]+$/,"26个大写英文字母组成的字符串"],enlower:[/^[a-z]+$/,"26个小写英文字母组成的字符串"],words:[/^[A-Za-z0-9]+$/,"数字和26个英文字母组成的字符串"],simplewords:[/^\w+$/,"数字、26个英文字母或者下划线"],username:[/^[\一\?-Za-z0-9-_]*$/,"中英文，数字，下划线，减号"],password:[/^[a-zA-Z]\w{5,17}$/,"以字母开头，长度在6-18之间，只能包含字符、数字和下划线"],nospecial:[/^([\u4e00-\u9fa5-a-zA-Z0-9]+)$/,"不能输入特殊字符！"],any:[/^.*$/,""]},showTip:function(e){0===this.dom.find(".input-alert").length&&$("<div class='input-alert'><i class='fa fa-exclamation-circle'></i> "+e+"</div>").appendTo(this.dom)},hideTip:function(){this.dom.find(".input-alert").remove()},check:function(){var e=!1;return this.customCheck?this.customCheck.call(this):(e=this.checkLength())?(this.hideTip(),(e=this.checkRequired())?(this.hideTip(),(e=this.checkRegular())?(this.hideTip(),!0):(this.showTip(this.reg[this.option.reg][1]||"格式不正确"),!1)):(this.showTip("必填选项"),!1)):(console.log(e),this.showTip("长度应该大于"+this.option.min+"小于"+this.option.max),!1)},checkDefault:function(){var e=this.checkLength();return e?(e=this.checkRegular())?(e=this.checkRequired(),e?!0:(this.showTip("必填选项"),!1)):(this.showTip(this.reg[this.option.reg][1]||"格式不正确"),!1):(this.showTip("长度应该大于"+this.option.min+"小于"+this.option.max),!1)},checkRequired:function(){var e=this.value;return this.option.required?e.length>0?!0:!1:!0},checkRemote:function(e,t){var i={},s=!1;return i[t]=this.value,$.ajax({url:e,data:i,dataType:"json",asysn:!1,success:function(e){s="1"===e.code?!0:!1},error:function(){s=!1}}),s},checkLength:function(e,t){var i=this.value+"";return 0===arguments.length?i.length>=this.option.min&&i.length<=this.option.max:2===arguments.length?i.length>=e&&i.length<=t:!1},checkRegular:function(e){var t=this.value;if(0===arguments.length&&(e=this.option.reg),""===e)return!0;if($.is.isString(e)){var i=this.reg[e][0];return i?i.test(t):!1}return e instanceof RegExp?e.test(t):!1},setValue:function(e){this.option.hook?(this.value=this.option.hook(e),this.input.val(this.value)):(this.value=e,this.input.val(e))},getValue:function(){return this.option.encode?require("@base64").encode(this.input.val()):this.input.val()},disable:function(e){return e?this.input.get(0).disabled=!0:this.input.get(0).disabled=!1,this},reset:function(){this.wrap.removeClass("error"),this.setValue(this.value)},empty:function(){this.input.val("")}}),Module({name:"hidetext",extend:"@.field",getValue:function(){return this.option.value}}),Module({name:"statictext",extend:"@.text",init:function(e){this.value=e.value,this.template=this.dom.html(),this.render(e)}}),Module({name:"select",extend:"@.field",option:{name:"",url:"",label:"",paraname:"12",isload:!1,next:"",keyname:"name",valuename:"value",defaults:[],remoteData:[]},template:module.getTemplate("@formtemplate","select"),init:function(e){this.render(e),this.value=this.option.value||this.dom.find("select").val(),e.url&&""!==e.url&&this.loadData()},bind_select:function(e){this.value=e.val(),this.dispatchEvent("selectchange",{value:this.value,next:this.option.next})},loadData:function(e){var t={},i=this;t[this.option.paraname]=e,this.postData({url:this.option.url,data:t,back:function(e){i.option.remoteData=e,i.render(i.option),i.value=i.dom.find("select").val(),i.dispatchEvent("selectchange",{value:i.value,next:i.option.next})}})},setValue:function(e){this.value=e,this.option.value=e,this.dom.find("select").children().each(function(){return $(this).attr("value")===e+""?($(this).get(0).selected="selected",!1):void 0})},reset:function(){this.render(this.option)}}),Module({name:"radiogroup",extend:"@.field",option:{label:"radio",radios:[{key:"xxxx",value:"xx"}]},template:module.getTemplate("@formtemplate","radiogroup"),init:function(e){this.render(e),this.value=this.option.value,""===e.value&&(this.dom.find("input[type='radio']").get(0).checked=!0)},getValue:function(){var e=null;return this.dom.find("input").each(function(){return $(this).get(0).checked?(e=$(this).attr("value"),!1):void 0}),e},setValue:function(e){this.value=e,this.dom.find("input").each(function(){$(this).attr("value")===e+""?$(this).get(0).checked=!0:$(this).get(0).checked=!1})},reset:function(){var e=this.value;null===e||e+""==""?this.dom.find("input").get(0).checked=!0:this.dom.find("input").each(function(){$(this).attr("value")===e+""?$(this).get(0).checked=!0:$(this).get(0).checked=!1})}}),Module({name:"checkboxgroup",extend:"@.field",option:{label:"checkboxgroup",checkboxs:[{key:"xxxx",value:"xx"}]},template:module.getTemplate("@formtemplate","checkboxgroup"),init:function(e){if(this.render(e),""!==this.option.value){var t=this.option.value.split(",");for(var i in t){var s=this.dom.find("input[value='"+t[i]+"']");s.length>0&&(s.get(0).checked=!0)}}},getValue:function(){var e="";return this.dom.find("input[type='checkbox']").each(function(){$(this).get(0).checked&&(e+=$(this).attr("value")+",")}),e.length>0&&(e=e.substring(0,e.length-1)),e},setValue:function(e){this.value=e;var t=e.split(",");for(var i in t){var s=this.dom.find("input[value='"+t[i]+"']");s.length>0&&(s.get(0).checked=!0)}return this},reset:function(){var e=this.value,t=e.split(",");for(var i in t){var s=this.dom.find("input[value='"+t[i]+"']");s.length>0&&(s.get(0).checked=!0)}}}),Module({name:"timmerfield",extend:"@.asysfield",template:"<div>timmer</div>",init:function(){this.render()},asys:function(e){var t="111";setTimeout(function(){e&&e(t)},3e3)}}),Module({name:"imagesuploader",className:"imagesuploader",extend:"@.asysfield",option:{url:"upload.php",deleteurl:"data/dataok.json",editurl:"data/images.json",filename:"file",title:"图片上传"},template:module.getTemplate("@formtemplate","imagesuploader"),init:function(){this.files=[],this.result=[],this.render(this.option),this.getData()},bind_file:function(e,i){for(var s=this,n=i.target.files||i.dataTransfer.files,a=0;a<n.length;a++){var o=require("@file").set(n[a]),r=!1;for(var l in this.files)if(this.files[l].fileName===o.fileName()){r=!0;break}r||(o.getImage(function(e){var i=e.width/e.height*150,n=0,a=0;150>=i?n=(150-i)/2:(_h=e.height/e.width*150,_h<=150&&(a=(150-_h)/2)),t=o.fileName().split("/");var r="<div class='imagesuploader-image' fid='"+s.files.length+"'><div class='imagesuploader-image-bg' style='background-image:url("+e.src+")'></div><div class='imageuploader-remove' data-bind='click:remove'><i class='fa fa-times'></i></div><div class='imageuploader-name' title='"+t[t.length-1]+"'>"+t[t.length-1]+"</div><div class='imageuploader-progress'></div></div>",l=$(r).insertBefore(s.dom.find(".imagesuploader-container").children(0));this._dom=l,s.delegateEvent()}),this.files.push(o))}},bind_remove:function(e){var t=e.parent().attr("mid");t?this.postData({url:this.option.deleteurl,data:this.result[t],back:function(){e.parent().remove()}}):(this.files.splice(e.parent().attr("fid"),1),e.parent().remove())},bind_upload:function(){var e=this;for(var t in this.files)this.files[t].upload({url:this.option.url,name:this.option.filename,start:function(){this._dom.find(".imageuploader-remove").hide()},progress:function(e){this._dom.find(".imageuploader-progress").width(e.percent+"%")},success:function(t){this._dom.find(".imageuploader-progress").width(0),this._dom.find(".imageuploader-remove").show(),this._dom.attr("mid",e.result.length),e.result.push(t);for(var i in e.files)e.files[i]===this&&e.files.splice(i,1)},error:function(){}})},getData:function(){var e=this;this.postData({url:this.option.editurl,back:function(t){for(var i in t)$.loader().image(t[i].url,function(){var s=this,n=s.src.split("/"),a="<div class='imagesuploader-image' mid='"+e.result.length+"'><div class='imagesuploader-image-bg' style='background-image:url("+s.src+")'></div><div class='imageuploader-remove' data-bind='click:remove'><i class='fa fa-times'></i></div><div class='imageuploader-name' title='"+n[n.length-1]+"'>"+n[n.length-1]+"</div><div class='imageuploader-progress'></div></div>";$(a).insertBefore(e.dom.find(".imagesuploader-container").children(0)),e.result.push(t[i]),e.delegateEvent()})}})},asys:function(e){var t=this;this.dom.addClass("hover"),this._file.upload({url:"upload.php",name:"file",asysn:!0,out:6e6,progress:function(e){t.dom.find(".loadingbar-color").width(e.percent+"%")},error:function(){},success:function(i){t.dom.removeClass("hover"),e&&e(i.data)}})}}),Module({name:"textarea",extend:"@.text",template:module.getTemplate("@formtemplate","textarea"),init:function(){this.superClass("init",this.option)},bind_keyup:function(e){this.value=e.text(),this.check()},setValue:function(e){this.option.hook?(this.value=this.option.hook(e),this.input.text(this.value)):(this.value=e,this.input.text(e))},getValue:function(){return this.option.encode?require("@base64").encode(this.input.text()):this.input.text()}}),Module({name:"pagelist",extend:"@.select",init:function(e){this.option.url=basePath+"contenter/getallpagemapping",this.value=this.option.value,this.render(e),e.url&&""!==e.url&&this.loadData()}}),Module({name:"extendform",extend:"@.asysfieldgroup",className:"extendform",option:{fields:[{type:"@.text",label:"type",name:"type"},{type:"@.text",label:"label",name:"label"},{type:"@.text",label:"name",name:"name"}]},layout:module.getTemplate("@formtemplate","extendform"),init:function(){},find_add:function(e){e.button(function(e,t){var i=$(module.getTemplate("@formtemplate","extendformcell")).appendTo(t.dom.find(".extendform-con"));t.addChild({type:"@.simpleform",option:{fields:t.option.fields},container:i.find(".extendform-form")})},this)},find_remove:function(e){e.button(function(e,t){if($(this).hasClass("check"))$(this).parent(".extendform-cell").remove();else{var i=$(this);$(this).html("<i class='fa fa-circle-cross'></i>").addClass("check"),setTimeout(function(){i.nodes&&i.nodes.length>0&&i.html("<i class='fa fa-cross'></i>").removeClass("check")},2e3)}},this)},asys:function(e){var t=[],i=this.children.length;this.children.length>0?this.childEach(function(){this.getValues().done(function(s){t.push(s),i--,0===i&&e&&e(t)})}):e&&e(t)},getValue:function(){var e=[],t=this.children.length,i=$.promise();return this.children.length>0?this.childEach(function(){this.getValues().done(function(s){e.push(s),t--,0===t&&i.resolve(window.JSON.stringify(e))})}):i.resolve(e),i},setValue:function(e){this.dom.find(".extendform-con").empty(),$.is.isString(e)&&(e=window.JSON.parse(e));for(var t in e){var i=$(module.getTemplate("@formtemplate","extendformcell")).appendTo(this.dom.find(".extendform-con"));this.addChild({type:"@.simpleform",option:{fields:this.option.fields},parameters:e[t],container:i.find(".extendform-form")})}},empty:function(){this.dom.find(".extendform-con").empty()}}),Module({name:"imageupload",className:"imageupload",extend:"@.asysfield",option:{url:basePath+"file/upload",filename:"file"},template:module.getTemplate("@formtemplate","imageupload"),init:function(){this._file=null,this.render(this.value)},bind_input:function(e,t){var i=this,s=t.target.files||t.dataTransfer.files;this._file=require("@file").set(s[0]),this._file.getImage(function(e){i.dom.children(0).css("background-image","url("+e.src+")")})},asys:function(e){var t=this;this.dom.addClass("hover"),this._file?this._file.upload({url:t.option.url,name:t.option.filename,dataType:"json",progress:function(e){t.dom.find(".loadingbar-color").width(e.percent+"%")},error:function(){e&&e("")},success:function(i){t.dom.removeClass("hover"),e&&e("file/view?fid="+i.data)}}):e&&e(this.value)},setValue:function(e){this.value=e,this.dom.children(0).css("background-image","url("+(-1===e.indexOf("http")?basePath+e:e)+")")}}),Module({name:"staticform",extend:"@.baseform"}),Module({name:"simpleform",className:"simpleform",extend:"@.baseform",layout:module.getTemplate("@formtemplate","simpleform"),init:function(){this.setValues(this.parameters)},onbeforesubmit:function(e){var t=this.dom.parent();t.length>0&&t.scrollingTop(0),0===this.dom.find(".form-mask").length&&(this.mask=$("<div class='form-mask'><div class='form-mask-loading'><i class='fa fa-refresh fa-spin'></i></div><div class='form-mask-mes'>Loading...</div></div>").insertBefore(this.getChildAt(0).dom))},onsubmitback:function(){var e=this;this.mask.html("<div class='form-mask-loading'><i class='fa fa-check'></i></div><div class='form-mask-mes'>success</div>"),setTimeout(function(){e.dom&&e.dom.find(".form-mask").remove()},2e3)},onsubmiterror:function(){var e=this;this.mask.html("<div class='form-mask-loading'><i class='fa fa-times'></i></div><div class='form-mask-mes'>error</div>"),setTimeout(function(){e.dom&&e.dom.find(".form-mask").remove()},2e3)},onneterror:function(){this.mask.html("<div class='form-mask-loading'><i class='fa fa-times'></i></div><div class='form-mask-mes'>net error</div>")}}),Module({name:"listform",className:"listform",extend:"@.baseform",layout:module.getTemplate("@formtemplate","listform"),init:function(){this.setValues(this.parameters)},find_tips:function(e){this.tips=e},onbeforesubmit:function(e){this.dom.addClass("checked"),this.tips.html("<i class='fa fa-refresh fa-spin'></i> loading...")},onsubmitback:function(){var e=this;this.tips.html("<i class='fa fa-check'></i> deal ok"),setTimeout(function(){e.dom&&e.dom.removeClass("checked")},2e3)},onsubmiterror:function(){var e=this;this.tips.html("<i class='fa fa-times'></i> deal error"),setTimeout(function(){e.dom&&e.dom.removeClass("checked")},2e3)},onneterror:function(){var e=this;this.tips.html("<i class='fa fa-times'></i> deal net error"),setTimeout(function(){e.dom&&e.dom.removeClass("checked")},2e3)}}),Module({name:"martform",extend:"@.baseform",className:"martform",layout:module.getTemplate("@formtemplate","martform"),btn_submit:function(){this.submit()},onbeforesubmit:function(e){this.dom.toastlite().setStart()},onsubmitback:function(e){this.dom.toastlite().setSuccess("处理成功")},onsubmiterror:function(e){this.dom.toastlite().setDataError(e.msg)},onneterror:function(){this.dom.toastlite().setNetError()}}),Module({name:"singleform",extend:"@.baseform",className:"singleform",option:{btns:[{action:"submit",name:"submit",icon:"fa fa-times"}]},layout:module.getTemplate("@formtemplate","singleform"),init:function(){},btn_submit:function(){this.submit()},onbeforesubmit:function(e){this.dom.toastlite().setStart()},onsubmitback:function(){this.dom.toastlite().setSuccess()},onsubmiterror:function(){this.dom.toastlite().setDataError()},onneterror:function(){this.dom.toastlite().setNetError()}}),Module({name:"gridform",extend:"@.baseform",option:{cols:6},layout:module.getTemplate("@formtemplate","gridform"),init:function(){this.setValues(this.parameters)}}),Module({name:"freeform",extend:"@.baseform",option:{btns:[]},layout:module.getTemplate("@formtemplate","freeform"),init:function(){this.setValues(this.parameters),this.dom.find(".btn").each(function(){$(this).click(function(){var e=$(this).attr("type");ths.dispatchEvent("freeform_"+e,ths.getValues())})})},onbeforeinit:function(e){console.log(e)},onsetlayout:function(e){if(this.option.btns.length>0){var t="<div style='position:absolute;left:0;top:0;right:0;bottom:50px;overflow:auto;padding:10px;'>"+e+"</div><div style='position:absolute;left:0;right:0;bottom:0;padding:10px 10px 0 10px;border-top:1px solid #D7D7D7;'><div class='btn-group'><%for(var i in data.option.btns){%><div class='btn' type='<%=data.option.btns[i].type;%>'><%=data.option.btns[i].name;%></div><%}%></div></div>";return t}return e},ondomready:function(e){console.log(e);var t=this.getId(),i=this;this.dom.find("div[viewid]").each(function(){var e=$(this).attr("viewid"),s=i.option.fields[e];$(this).attr("view-"+t,s._type)})},onoption:function(e,t,i){return this.option.fields[i]},event_freeform_submit:function(e){this.check()&&this.submit(),e.stop()},event_freeform_reset:function(e){this.reset(),e.stop()}}),Module({name:"imagesuploaderasys",className:"imagesuploaderasys",extend:"@.asysfield",option:{url:basePath+"task/saveAttach",filename:"file"},template:module.getTemplate("@formtemplate","imagesuploaderasys"),init:function(){this.files=[],this.result=[],this.render(this.option)},setFile:function(e){e=window.JSON.parse(e);for(var t in e){var i="<div class='imagesuploader-image' rid='"+this.result.length+"'><div class='imagesuploader-image-bg' style='background-image:url("+e[t]+")'></div><div class='imageuploader-remove' data-bind='click:remove'><i class='fa fa-times'></i></div><div class='imageuploader-progress'></div></div>";$(i).insertBefore(this.dom.find(".imagesuploader-container").children(0)),this.result.push(e[t])}this.delegateEvent()},bind_file:function(e,t){for(var i=this,s=t.target.files||t.dataTransfer.files,n=0;n<s.length;n++){var a=require("@file").set(s[n]),o=!1;for(var r in this.files)if(this.files[r].fileName===a.fileName()){o=!0;break}o||(!function(e){var t="<div class='imagesuploader-image' fid='"+i.files.length+"'><div class='imagesuploader-image-bg'>loading...</div><div class='imageuploader-remove' data-bind='click:remove'><i class='fa fa-times'></i></div><div class='imageuploader-progress'></div></div>",s=$(t).insertBefore(i.dom.find(".imagesuploader-container").children(0));e.getImage(function(t){s.find(".imagesuploader-image-bg").css("background-image","url("+t.src+")").empty(),e._dom=s,i.delegateEvent()})}(a),this.files.push(a))}},bind_remove:function(e){e.parent().attr("fid")&&this.files.splice(e.parent().attr("fid"),1),e.parent().attr("rid")&&this.result.splice(e.parent().attr("rid"),1),e.parent().remove()},setValue:function(e){this.setFile(e)},asys:function(e){var t=this;if(this.files.length>0)for(var i in this.files)this.files[i].upload({url:this.option.url,name:this.option.filename,dataType:"json",start:function(){this._dom.find(".imageuploader-remove").hide()},progress:function(e){this._dom.find(".imageuploader-progress").width(e.percent+"%")},success:function(i){console.log(i),this._dom.attr("rid",t.result.length),this._dom.removeAttr("fid"),this._dom.find(".imageuploader-progress").width(0),this._dom.find(".imageuploader-remove").show(),t.result.push(i.data);for(var s in t.files)t.files[s]===this&&t.files.splice(s,1);e&&e(t.result)},error:function(){}});else e&&e(this.result)}}),Module({name:"stars",extend:"@.field",className:"stars",template:module.getTemplate("@formtemplate","stars"),init:function(){this.render()},find_star:function(e){this.stars||(this.stars=[]),this.stars.push(e);var t=this;e.button(function(){for(var e=!1,i=0;i<t.stars.length;i++)t.stars[i].get(0)!==$(this).get(0)?e===!1?t.stars[i].addClass("select"):t.stars[i].removeClass("select"):(e=!0,t.stars[i].addClass("select"))})},getValue:function(){for(var e=0,t=0;t<this.stars.length;t++)this.stars[t].hasClass("select")&&e++;return e},setValue:function(e){if($.is.isNumber(e)&&5>=e&&e>0)for(var t=0;e>t;t++)this.stars[t].addClass("select")},reset:function(){for(var e=0;e<this.stars.length;e++)this.stars[e].removeClass("select");return this},check:function(){return!0}}),Module({name:"duanxin",extend:"@.text",className:"duanxin",template:module.getTemplate("@formtemplate","duanxin"),option:{url:basePath+"data/dataok.json",reg:"phone",required:!0},init:function(){this.option.reg="phone",this.option.required=!0,this.render(this.option)},find_get:function(e){e.button(function(e,t){if(t.check()&&!$(this).hasClass("active")){$(this).addClass("active");var i=$(this);t.postData({url:t.option.url,back:function(){$.toast("验证码已成功发送到手机"),i.html("60s");for(var e=1;60>=e;e++)setTimeout(function(){var e=parseInt(i.html());i.html(e-1+"s"),1===e&&i.removeClass("active").html("重新获取")},1e3*e)},dataerror:function(){$.toast("网络错误，请稍后重试")},neterror:function(){$.toast("网络错误，稍后重试")}})}},this)}}),Module({name:"picode",extend:"@.text",className:"picode",option:{url:basePath+"user/picCode"},template:module.getTemplate("@formtemplate","picode"),find_pic:function(e){e.button(function(e,t){$(this).children(0).attr("src",t.option.url+"?t="+(new Date).getTime())},this)}}),Module({name:"codebtn",extend:"view",className:"codebtn",option:{url:basePath+"data/dataok.json"},template:module.getTemplate("@formtemplate","codebtn"),init:function(){this.render()},check:function(){return!0},setData:function(e){return this._data=e,this},find_get:function(e){e.button(function(e,t){var i=$(this);t.check().done(function(){if(!i.hasClass("active")){i.addClass("active");var e=i;t.postData({url:t.option.url,data:t._data,back:function(){$.toast("验证码已成功发送到手机"),e.html("60秒后重新获取");for(var t=1;60>=t;t++)setTimeout(function(){var t=parseInt(e.html());e.html(t-1+"秒后重新获取"),1===t&&e.removeClass("active").html("重新获取")},1e3*t)},dataerror:function(){$.toast("网络错误，请稍后重试")},neterror:function(){$.toast("网络错误，稍后重试")}})}})},this)}}),Module({name:"multiselect",extend:"@.field",className:"multiselect",template:module.getTemplate("@formtemplate","multiselect"),option:{name:"",url:"",label:"",keyname:"name",valuename:"value",defaults:[],remoteData:[],value:""},init:function(e){this.render(this.option),this.value=this.option.value,e.url&&""!==e.url&&this.loadData()},find_item:function(e){e.button(function(){$(this).toggleClass("selected")})},loadData:function(e){var t={},i=this;t[this.option.paraname]=e,this.postData({url:this.option.url,data:t,back:function(e){i.option.remoteData=e,i.render(i.option);var t=i.value.split(",");for(var s in t){var n=t[s];i.finders.getItems("item").forEach(function(e){e.dom().attr("value")===n&&e.dom().addClass("selected")})}}})},getValue:function(){var e=[];return this.finders.getItems("item").forEach(function(t){t.dom().hasClass("selected")&&e.push(t.dom().attr("value"))}),e.join(",")},setValue:function(e){if(this.value=e,this.option.value=e,""!==t&&this.finders.getItems("item")){var t=e.split(",");for(var i in t)this.finders.getItems("item").forEach(function(e){e.dom().attr("value")===t[i]&&e.dom().addClass("selected")})}},reset:function(){this.render(this.option)}});